<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Products</title>
    <!--    <link rel="stylesheet" href="style.css"/>-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <nav class="nav justify-content-center">
        <a class="nav-link" href="#">home</a>
        <a class="nav-link" href="#">about</a>
        <a class="nav-link" href="#">contact us</a>
    </nav>
    <div class="my-2">
        <button id="add-button" type="button" data-toggle="modal" data-target="#add-modal" class="btn btn-success">Add</button>
    </div>
    <table id="products-tbl" class="table table-sm table-hover"></table>
</div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="edit-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="edit-modal-title">Редактировать</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col">
                    <input class="form-control" type="text" placeholder="Product name"
                           aria-label="default input example">
                </div>
                <div class="col">
                    <select class="form-select product-type-select"></select>
                    <input class="form-control" type="text" placeholder="Product type"
                           aria-label="default input example">
                </div>
                <div class="col">
                    <input class="form-control" type="text" placeholder="Cost" aria-label="default input example">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-outline-success">Save changes</button>
            </div>
        </div>
    </div>
</div>
<!-- Delete Modal -->
<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="delete-modal-title">Редактировать</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col">
                    <p>Delete record?</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cansel</button>
                <button type="button" class="btn btn-outline-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
<!-- Create Modal -->
<div class="modal fade" id="add-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="add-modal-title">Создать</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-body">
                <div class="col my-2">
                    <input class="form-control" type="text" placeholder="product name" data-field="productName">
                </div>
                <div class="col my-2">
                    <select class="form-select product-type-select"></select>
                    <input class="form-control" type="text" placeholder="product type" data-field="productType">
                </div>
                <div class="col my-2">
                    <input class="form-control" type="text" placeholder="cost" data-field="cost">
                </div>
                    <div class="col my-2">
                        <input class="form-control" type="text" placeholder="quantity" data-field="quantity">
                    </div>
            </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cansel</button>
                <button type="button" class="btn btn-outline-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
</body>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script>

    class Product {
        constructor(id, name, type, cost, quantity) {
            this.id = id;
            this.name = name;
            this.type = type;
            this.cost = cost;
            this.quantity = quantity;
        }
    }

    class ProductType {
        constructor(type, name) {
            this.type = type;
            this.name = name;
        }
    }
    // formProductsTable(fruits)

    const endpoint = "http://localhost:8080/api/";
    findAllLinks();
    initProductTypes();

    function findAllLinks() {
        fetch(endpoint + "product/find-all")
            .then((response) => {
                console.log("commented")
                return checkResponseStatus(response);
            })
            .then((data) => {
                if (typeof data === 'undefined') {
                    return;
                }
                console.log(data);
                formProductsTable(data);
            });
    }

    function checkResponseStatus(response) {
        if (response.ok) {
            return response.json();
        } else {
            operateOnResponseStatus(response);
        }
        return undefined;
    }

    function initProductTypes() {
        fetch(endpoint + "product-type/find-all")
            .then((response) => {
                console.log("commented")
                return checkResponseStatus(response);
            })
            .then((data) => {
                if (typeof data === 'undefined') {
                    return;
                }
                console.log(data);
                generateChoice(data);
            });
    }

    function generateChoice(data) {
        let selects = $(".product-type-select").get();
        selects.forEach((dt) => {
            data.forEach(function (item) {
                let op = document.createElement("option");
                op.value = item.type;
                op.innerHTML = item.name;
                dt.appendChild(op);
            })
        })
    }

    function formProductsTable(products) {
        const table = document.getElementById("products-tbl");

        formTableHeader();

        products.forEach(function (item) {
            let row = table.insertRow();

            addCell(row, item.id).setAttribute("scope", "row");
            addCell(row, item.name);
            addCell(row, item.type);
            addCell(row, item.cost);
            addCell(row, item.quantity);
            addRowControl(row, item.id, "edit", "#edit-modal")
            addRowControl(row, item.id, "delete", "#delete-modal")
        });

        function formTableHeader() {
            fillTableHeader(createTableHeader());
        }

        function createTableHeader() {
            let thead = table.createTHead();
            thead.setAttribute("class", "thead-light");
            return thead.insertRow();
        }

        function fillTableHeader(headerRow) {

            addTableHeaderCell(headerRow, '#')
            addTableHeaderCell(headerRow, 'Name');
            addTableHeaderCell(headerRow, 'Type');
            addTableHeaderCell(headerRow, 'Cost');
            addTableHeaderCell(headerRow, 'Quantity');
            addTableHeaderCell(headerRow, '');
            addTableHeaderCell(headerRow, '');

        }

        function addTableHeaderCell(tr, text) {
            let th = document.createElement("th");
            th.textContent = text;
            th.setAttribute("scope", "col")
            tr.appendChild(th);
            return th;
        }

        function addCell(tr, text) {
            let td = tr.insertCell();
            td.textContent = text;
            return td;
        }

        function addRowControl(tr, id, text, modal) {
            let cell = tr.insertCell();
            let btn = document.createElement('input');
            btn.type = "button";
            btn.className = "btn btn-outline-secondary btn-sm";
            btn.setAttribute("data-row-id", id);
            btn.setAttribute("data-toggle", "modal");
            btn.setAttribute("data-target", modal);
            btn.value = text
            btn.onclick = () => {
                console.log(btn)
            };
            cell.appendChild(btn);
        }
    }

    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus');
    })

    // $('#add-button').on('click', function ()  {
    //     console.log($(this));
    // })
</script>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</html>